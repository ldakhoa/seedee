name: Seedee

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - "*"

jobs:
  UnitTest:
    runs-on: macos-12
    steps:
      - uses: actions/checkout@v3
      - name: Select Xcode version
        run: sudo xcode-select -s '/Applications/Xcode_14.2.app/Contents/Developer'
      - name: SwiftLint
        run: swiftlint --strict
      - name: Build Package
        run: swift build -v
      - name: Create temporary directory
        id: create-temp-dir
        run: |
          temp_dir=$(mktemp -d)
          echo "TEMP_DIR=$temp_dir" >> $GITHUB_ENV
      - name: Create ExportOptions.plist file
        run: |
          echo "Creating ExportOptions.plist"
          echo "${{ secrets.EXPORT_OPTIONS_PLIST }}" > $TEMP_DIR/ExportOptions.plist
      - name: Create and install Provisoning Profile
        run: |
          echo "Creating Provisioning Profile"
          echo $PROVISIONING_PROFILE | base64 --decode > $TEMP_DIR/seedee_provisoning_profile.mobileprovisioning
      - name: Run Unit Tests
        run: swift test -v
        env:
          SHOULD_SETUP_COCOAPODS: 1
          SETUP_PROVISIONING_PROFILE: 1
          PROVISIONING_PROFILE: ${{ secrets.PROVISIONING_PROFILE }}
