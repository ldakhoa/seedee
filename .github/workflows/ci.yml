name: Seedee

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - "*"

jobs:
  UnitTest:
    runs-on: macos-12
    steps:
      - uses: actions/checkout@v3
      - name: Select Xcode version
        run: sudo xcode-select -s '/Applications/Xcode_14.2.app/Contents/Developer'
      - name: SwiftLint
        run: swiftlint --strict
      - name: Build Package
        run: swift build -v
      - name: Set temporary to use in Unit Test
        id: set-temp-dir
        run: |
          echo "TEMP_DIR=$RUNNER_TEMP" >> $GITHUB_ENV
      - name: Create ExportOptions.plist file that supports Unit Test
        run: |
          echo "Creating ExportOptions.plist"
          echo "${{ secrets.EXPORT_OPTIONS_PLIST }}" > $TEMP_DIR/ExportOptions.plist
      - name: Create and install Provisoning Profile
        run: |
          # create variables
          PP_PATH=$TEMP_DIR/build_pp_unit_test.mobileprovision

          # import certificate and provisioning profile from secrets
          echo "Creating Provisioning Profile from $PP_PATH"
          echo -n "$BUILD_PROVISION_PROFILE_BASE64" | base64 --decode -o $PP_PATH
      - name: Run Unit Tests
        run: swift test -v
        env:
          SHOULD_SETUP_COCOAPODS: 1
          SETUP_PROVISIONING_PROFILE: 1
          SKIP_UNIT_TEST: 0
          PROVISIONING_PROFILE: ${{ secrets.PROVISIONING_PROFILE }}
          BUILD_PROVISION_PROFILE_BASE64: ${{ secrets.BUILD_PROVISION_PROFILE_BASE64 }}
